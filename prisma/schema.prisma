// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgres"
    // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
    // Further reading:
    // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
    // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
    url      = env("DATABASE_URL")
}

// Necessary for Next auth
model Account {
    id                String  @id @default(cuid())
    userId            String
	firstName		  String
	lastName		  String
	role			  String
	repository Repository[]
}

model Branch {
	id	String @id @default(cuid())
	repository_id String
	name String
	label String
	url String
	pullRequest PullRequest?
}

model PullRequest {
	id String @id @default(cuid())
	repository_id String
	title String
	body String
	url String
	branch_id String @unique
	branch Branch @relation(fields: [branch_id], references: [id])
}

model Location {
	id String @id @default(cuid())
	file String
	start Int
	end Int

	component ComponentElement?
	attribute ComponentAttribute?
	definition ComponentDefinition?
}

model ComponentElement {
	id String @id @default(cuid())
	repository_id String
	name String
	children ComponentElement[] @relation("children")
	location_id String @unique
	location Location @relation(fields: [location_id], references: [id])
	parent_id String?
	parent ComponentElement? @relation(name: "children", fields: [parent_id], references: [id])
	definition_id String
	definition ComponentDefinition @relation(name: "definition", fields: [definition_id], references: [id])
	attributes ComponentAttribute[]
}

model ComponentAttribute {
	id String @id @default(cuid())
	type String
	name String
	value String
	component_id String @unique
	component ComponentElement @relation(fields: [component_id], references: [id])
	location_id String @unique
	location Location @relation(fields: [location_id], references: [id])
}

model ComponentDefinition {
	id String @id @default(cuid())
	repository_id String
	name String @unique
	children ComponentElement[] @relation("definition")
	location_id String @unique
	location Location @relation(fields: [location_id], references: [id])
}

model Repository {
	id String @id @default(cuid())
	account_id String
	name String
	owner String
	branch String
	installationId Int
	account Account @relation(fields: [account_id], references: [id])
}